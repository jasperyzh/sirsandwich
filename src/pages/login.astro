---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Account - Sirsandwich Shop">
  <main class="min-h-screen bg-gray-50 py-12">
    <div class="container mx-auto px-4">
      <!-- Page Header -->
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800 mb-4">Your Account</h1>
        <p class="text-gray-600 max-w-2xl mx-auto">
          Sign in to your account to manage your profile, view orders, and enjoy a personalized shopping experience.
        </p>
      </div>

      <!-- Auth Component Container -->
      <div id="auth-app" class="max-w-4xl mx-auto">
        <!-- Vue components will be mounted here -->
      </div>
    </div>
  </main>
</Layout>

<script>
  import { createApp } from 'vue'
  import { pinia } from '../stores/pinia.js'
  import { useAuthStore } from '../stores/authStore.js'
  import AuthForm from '../components/AuthForm.vue'
  import UserProfile from '../components/UserProfile.vue'

  // Create Vue app with inline component
  const app = createApp({
    components: {
      AuthForm,
      UserProfile
    },
    setup() {
      const authStore = useAuthStore()
      
      // Initialize auth store
      authStore.initialize()

      return {
        authStore
      }
    },
    methods: {
      handleAuthSuccess(data) {
        console.log('üéâ Authentication successful:', data.type)
      },
      handleSignOut() {
        console.log('üëã User signed out')
      },
      handleViewOrders() {
        console.log('üìã Redirecting to orders page')
        window.location.href = '/orders'
      },
      handleBrowseProducts() {
        console.log('üõí Redirecting to products page')
        window.location.href = '/products'
      },
      handleAdminDashboard() {
        console.log('‚öôÔ∏è Redirecting to admin dashboard')
        window.location.href = '/admin'
      }
    },
    template: `
      <div class="max-w-4xl mx-auto">
        <!-- Loading State -->
        <div v-if="authStore.loading && !authStore.user" class="text-center py-12">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"></div>
          <p class="text-gray-600 mt-4">Loading your account...</p>
        </div>

        <!-- Authentication Form (when not logged in) -->
        <AuthForm 
          v-else-if="!authStore.isAuthenticated"
          @auth-success="handleAuthSuccess"
        />

        <!-- User Profile (when logged in) -->
        <UserProfile 
          v-else
          @signed-out="handleSignOut"
          @view-orders="handleViewOrders"
          @browse-products="handleBrowseProducts"
          @admin-dashboard="handleAdminDashboard"
        />
      </div>
    `
  })

  app.use(pinia)
  app.mount('#auth-app')
</script>

<style>
  /* Loading animation */
  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }
  
  .animate-spin {
    animation: spin 1s linear infinite;
  }
</style> 